<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>IRCTC â€“ Home</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
    :root { --irctc-blue: #213d77; --irctc-red: #d11010; --bg-color: #f3f4f6; }
    body { background: var(--bg-color); font-family: 'Segoe UI', sans-serif; color: #1f2937; -webkit-tap-highlight-color: transparent; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    @keyframes trainMoveRight { from { transform: translateX(-100%); } to { transform: translateX(400%); } }
    .anim-fade { animation: fadeIn 0.3s ease-out forwards; }
    .anim-slide { animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    .bg-train-anim {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='20' viewBox='0 0 100 20'%3E%3Cpath fill='%23ffffff' fill-opacity='0.1' d='M10,10 L20,10 L20,15 L10,15 Z M25,10 L35,10 L35,15 L25,15 Z M40,10 L50,10 L50,15 L40,15 Z'/%3E%3C/svg%3E");
        animation: trainMoveRight 15s linear infinite;
        position: absolute; bottom: 0; left: 0; width: 100%; height: 40px;
    }
    .glass-dark { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

    const getUser = () => JSON.parse(localStorage.getItem('irctc_current_user'));
    
    // ... [Common data arrays like STATIONS/CLASSES same as before] ...
    const QUICK_ACTIONS = [
        { icon: 'file-search', label: 'PNR Status', color: 'bg-blue-100 text-blue-800' },
        { icon: 'train-front', label: 'Live Status', color: 'bg-emerald-100 text-emerald-800' },
        { icon: 'utensils', label: 'E-Catering', color: 'bg-orange-100 text-orange-800' },
        { icon: 'armchair', label: 'Seat Map', color: 'bg-purple-100 text-purple-800' },
    ];
    const CLASSES = [
        { code: 'ALL', name: 'All Classes' }, { code: 'SL', name: 'Sleeper (SL)' },
        { code: '3A', name: 'AC 3 Tier (3A)' }, { code: '2A', name: 'AC 2 Tier (2A)' },
        { code: '1A', name: 'AC First Class (1A)' }, { code: 'CC', name: 'AC Chair Car (CC)' },
        { code: '2S', name: 'Second Sitting (2S)' }
    ];
    const COMMON_STATIONS = [
        { c: 'NDLS', n: 'New Delhi' }, { c: 'CNB', n: 'Kanpur Central' }, { c: 'PNBE', n: 'Patna Jn' },
        { c: 'BCT', n: 'Mumbai Central' }, { c: 'HWH', n: 'Howrah Jn' }, { c: 'MAS', n: 'MGR Chennai Ctrl' },
        { c: 'SBC', n: 'KSR Bengaluru' }, { c: 'LKO', n: 'Lucknow NR' }, { c: 'JP', n: 'Jaipur Jn' }
    ];

    function GlassModal({ isOpen, onClose, title, children, center = false }) {
        if (!isOpen) return null;
        return (
            <div className={`fixed inset-0 z-50 glass-dark flex ${center ? 'items-center justify-center p-6' : 'justify-end flex-col'} anim-fade`} onClick={onClose}>
                <div onClick={e => e.stopPropagation()} className={`${center ? 'rounded-2xl w-full max-w-sm' : 'rounded-t-[2rem] h-[85vh]'} bg-white/95 backdrop-blur-xl shadow-2xl flex flex-col overflow-hidden anim-slide`}>
                    <div className="bg-[#213d77] text-white p-4 pt-5 flex items-center gap-4 shrink-0 relative">
                        <button onClick={onClose}><i data-lucide="x" className="w-6 h-6"></i></button>
                        <h2 className="text-lg font-bold">{title}</h2>
                    </div>
                    <div className="flex-1 overflow-y-auto flex flex-col">{children}</div>
                </div>
            </div>
        );
    }

    function StationSearch({ onSelect }) {
        const [query, setQuery] = React.useState("");
        const filtered = COMMON_STATIONS.filter(s => s.n.toLowerCase().includes(query.toLowerCase()) || s.c.toLowerCase().includes(query.toLowerCase()));
        return (
            <div className="flex flex-col h-full">
                <div className="p-4 border-b bg-slate-50 sticky top-0 z-10">
                    <div className="relative"><i data-lucide="search" className="absolute left-3 top-3.5 w-5 h-5 text-slate-400"></i>
                        <input autoFocus type="text" placeholder="Type City or Station..." className="w-full pl-10 pr-4 py-3 border rounded-lg outline-none focus:border-[#213d77] shadow-sm" value={query} onChange={(e) => setQuery(e.target.value)} />
                    </div>
                </div>
                <div className="flex-1 overflow-y-auto p-2">
                    {filtered.map(s => (
                        <div key={s.c} onClick={() => onSelect(s)} className="p-4 border-b hover:bg-blue-50 cursor-pointer flex justify-between items-center group">
                            <div><div className="font-bold text-slate-700">{s.n}</div><div className="text-xs text-slate-400">Indian Railways</div></div>
                            <span className="font-mono text-xs font-bold bg-slate-100 px-2 py-1 rounded text-slate-600">{s.c}</span>
                        </div>
                    ))}
                </div>
            </div>
        );
    }
    
    // Simple Calendar
    function RealCalendar({ onSelect }) {
        const [currDate, setCurrDate] = React.useState(new Date());
        const getDays = (y, m) => new Date(y, m + 1, 0).getDate();
        const startDay = (y, m) => new Date(y, m, 1).getDay();
        const days = Array.from({ length: getDays(currDate.getFullYear(), currDate.getMonth()) }, (_, i) => i + 1);
        const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];

        return (
            <div className="p-4">
                <div className="flex justify-between items-center mb-6">
                    <button onClick={() => setCurrDate(new Date(currDate.setMonth(currDate.getMonth()-1)))} className="p-2 hover:bg-slate-100 rounded-full"><i data-lucide="chevron-left"></i></button>
                    <span className="font-bold text-lg text-[#213d77]">{months[currDate.getMonth()]} {currDate.getFullYear()}</span>
                    <button onClick={() => setCurrDate(new Date(currDate.setMonth(currDate.getMonth()+1)))} className="p-2 hover:bg-slate-100 rounded-full"><i data-lucide="chevron-right"></i></button>
                </div>
                <div className="grid grid-cols-7 gap-2">{days.map(d=><div key={d} onClick={()=>onSelect(new Date(currDate.getFullYear(), currDate.getMonth(), d))} className="h-10 w-10 flex items-center justify-center rounded-full hover:bg-blue-100 hover:text-[#213d77] cursor-pointer font-medium text-slate-700">{d}</div>)}</div>
            </div>
        );
    }

    // --- VIEW: PROFILE (WITH DELETE LOGIC) ---
    function ProfileView({ onClose, onLogout }) {
        const user = getUser(); 
        
        const handleDeleteAccount = () => {
            if(confirm("Are you sure you want to delete your account? This action cannot be undone.")) {
                // 1. Get all users
                const allUsers = JSON.parse(localStorage.getItem('irctc_users') || "[]");
                // 2. Filter out current user
                const newUsers = allUsers.filter(u => u.username !== user.username);
                // 3. Save back
                localStorage.setItem('irctc_users', JSON.stringify(newUsers));
                // 4. Clear session
                localStorage.removeItem('irctc_current_user');
                // 5. Kick out
                window.location.href = 'index.html';
            }
        };

        return (
            <div className="fixed inset-0 z-40 bg-white anim-fade flex flex-col overflow-y-auto pb-10">
                <div className="bg-[#213d77] h-48 relative rounded-b-[3rem] shadow-lg shrink-0">
                    <button onClick={onClose} className="absolute top-6 left-6 text-white bg-white/20 p-2 rounded-full"><i data-lucide="arrow-left" className="w-6 h-6"></i></button>
                    <div className="absolute -bottom-12 left-1/2 -translate-x-1/2">
                        <div className="w-24 h-24 bg-white rounded-full p-1 shadow-xl">
                            <div className="w-full h-full bg-slate-200 rounded-full flex items-center justify-center overflow-hidden">
                                <span className="text-2xl font-bold text-[#213d77]">{user?.fullName?.charAt(0) || 'U'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div className="mt-16 text-center px-6">
                    <h2 className="text-2xl font-bold text-slate-800">{user?.fullName || "Guest User"}</h2>
                    <p className="text-slate-500">{user?.email || "guest@irctc.co.in"}</p>
                    <div className="mt-8 space-y-4">
                        <div className="p-4 bg-slate-50 rounded-xl flex items-center gap-4"><i data-lucide="phone" className="text-[#213d77]"></i> <span className="font-medium">{user?.mobile || "+91 XXXXX XXXXX"}</span></div>
                        <div className="p-4 bg-slate-50 rounded-xl flex items-center gap-4"><i data-lucide="user-check" className="text-[#213d77]"></i> <span className="font-medium">KYC Verified</span></div>
                        
                        <button onClick={onLogout} className="w-full py-3 mt-4 text-[#213d77] font-bold border border-[#213d77]/20 rounded-xl hover:bg-blue-50 active:scale-95 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="log-out" className="w-5 h-5"></i> Logout
                        </button>
                        
                        {/* DELETE BUTTON */}
                        <button onClick={handleDeleteAccount} className="w-full py-3 text-red-600 font-bold border border-red-100 bg-red-50 rounded-xl hover:bg-red-100 active:scale-95 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="trash-2" className="w-5 h-5"></i> Delete Account
                        </button>
                    </div>
                </div>
            </div>
        );
    }

    // --- MAIN DASHBOARD ---
    function Dashboard() {
        const [view, setView] = React.useState('home'); 
        const [modal, setModal] = React.useState(null);
        const [from, setFrom] = React.useState(null);
        const [to, setTo] = React.useState(null);
        const [date, setDate] = React.useState(null);
        const [trainClass, setTrainClass] = React.useState(CLASSES[0]);
        const [searching, setSearching] = React.useState(false);
        const user = getUser();

        React.useEffect(() => { 
            if(window.lucide) window.lucide.createIcons();
            if(!localStorage.getItem('irctc_current_user')) {
                window.location.href = 'index.html';
            }
        }, [view, modal]);

        const handleLogout = () => {
            localStorage.removeItem('irctc_current_user'); 
            window.location.href = 'index.html'; 
        };

        if (view === 'profile') return <ProfileView onClose={()=>setView('home')} onLogout={handleLogout} />;
        if (view === 'trips') return <div className="p-6 pt-10"><button onClick={()=>setView('home')} className="mb-4"><i data-lucide="arrow-left"></i></button><h2 className="text-2xl font-bold text-[#213d77]">My Trips</h2><div className="text-center py-20 text-slate-400">No trips booked yet.</div></div>;
        if (view === 'complaint') return <div className="p-6 pt-10"><button onClick={()=>setView('home')} className="mb-4"><i data-lucide="arrow-left"></i></button><h2 className="text-2xl font-bold text-[#213d77]">Support</h2><p className="text-slate-500">Describe your issue below...</p></div>;
        if (view === 'settings') return <div className="p-6 pt-10"><button onClick={()=>setView('home')} className="mb-4"><i data-lucide="arrow-left"></i></button><h2 className="text-2xl font-bold text-[#213d77]">Settings</h2><p>Logged in as: <b>{user?.username}</b></p></div>;

        return (
            <div className="max-w-md mx-auto min-h-screen bg-[#f3f4f6] relative shadow-2xl overflow-hidden pb-24">
                <header className="bg-[#213d77] text-white pt-10 pb-24 px-6 rounded-b-[2.5rem] shadow-lg relative overflow-hidden z-10">
                    <div className="bg-train-anim"></div>
                    <div className="relative z-10 flex justify-between items-center mb-8">
                        <div className="flex items-center gap-3">
                            <div className="w-9 h-9 bg-white rounded-lg shadow-md flex items-center justify-center"><img src="https://upload.wikimedia.org/wikipedia/en/4/45/IRCTC_Logo.svg" className="w-5 h-5" /></div>
                            <div><h1 className="font-bold text-lg leading-tight">IRCTC Rail</h1><p className="text-[10px] text-blue-200">Hello, {user?.fullName?.split(' ')[0] || 'User'}</p></div>
                        </div>
                        <div className="flex gap-3">
                            <button onClick={()=>setModal('notify')} className="bg-white/10 p-2 rounded-full backdrop-blur-md border border-white/20"><i data-lucide="bell" className="w-5 h-5"></i></button>
                            <button onClick={()=>setView('profile')} className="bg-white/10 p-2 rounded-full backdrop-blur-md border border-white/20"><i data-lucide="user" className="w-5 h-5"></i></button>
                        </div>
                    </div>
                </header>

                <div className="mx-5 -mt-20 relative z-20">
                    <div className="bg-white rounded-xl shadow-xl overflow-hidden p-6">
                        <div className="relative flex flex-col gap-0">
                            <div className="absolute right-4 top-1/2 -translate-y-1/2 z-20"><button onClick={()=>{const t=from;setFrom(to);setTo(t)}} className="w-10 h-10 bg-white border rounded-full flex items-center justify-center shadow text-[#213d77]"><i data-lucide="arrow-up-down" className="w-5 h-5"></i></button></div>
                            <div onClick={()=>setModal('from')} className="pb-4 border-b cursor-pointer pr-16"><label className="text-[10px] text-slate-400 font-bold uppercase">From</label>{from ? <div><div className="text-xl font-bold text-[#213d77]">{from.c}</div><div className="text-xs text-slate-500">{from.n}</div></div> : <div className="text-lg font-bold text-slate-300">Tap to Search</div>}</div>
                            <div onClick={()=>setModal('to')} className="pt-4 cursor-pointer pr-16"><label className="text-[10px] text-slate-400 font-bold uppercase">To</label>{to ? <div><div className="text-xl font-bold text-[#213d77]">{to.c}</div><div className="text-xs text-slate-500">{to.n}</div></div> : <div className="text-lg font-bold text-slate-300">Tap to Search</div>}</div>
                        </div>
                        <div className="flex gap-4 mt-6 mb-6">
                            <div onClick={()=>setModal('date')} className="flex-1 border rounded-lg p-2.5 flex items-center gap-3 cursor-pointer bg-slate-50"><i data-lucide="calendar" className="text-[#d11010]"></i><div><p className="text-[10px] text-slate-400 font-bold">DATE</p><p className="text-sm font-bold text-slate-700">{date?date.toLocaleDateString('en-GB',{day:'numeric',month:'short'}):'Choose'}</p></div></div>
                            <div onClick={()=>setModal('class')} className="flex-1 border rounded-lg p-2.5 flex items-center gap-3 cursor-pointer bg-slate-50"><i data-lucide="layers" className="text-[#213d77]"></i><div><p className="text-[10px] text-slate-400 font-bold">CLASS</p><p className="text-sm font-bold text-slate-700">{trainClass.code}</p></div></div>
                        </div>
                        <button onClick={()=>{setSearching(true);setTimeout(()=>setSearching(false),2000)}} className="w-full bg-[#d11010] text-white py-3.5 rounded-lg font-bold shadow-lg active:scale-95 transition-all">{searching?'Searching...':'SEARCH TRAINS'}</button>
                    </div>
                </div>

                <div className="mt-8 px-5 grid grid-cols-4 gap-3">{QUICK_ACTIONS.map((a,i)=>(<div key={i} className="flex flex-col items-center gap-2 cursor-pointer"><div className={`w-14 h-14 rounded-2xl flex items-center justify-center shadow-sm border ${a.color} border-white`}><i data-lucide={a.icon} className="w-6 h-6"></i></div><span className="text-[10px] font-bold text-slate-600 text-center">{a.label}</span></div>))}</div>

                {/* MODALS */}
                <GlassModal isOpen={modal==='from'||modal==='to'} onClose={()=>setModal(null)} title={modal==='from'?'Source':'Destination'}><StationSearch onSelect={s=>{if(modal==='from')setFrom(s);else setTo(s);setModal(null)}}/></GlassModal>
                <GlassModal isOpen={modal==='date'} onClose={()=>setModal(null)} title="Journey Date"><RealCalendar onSelect={d=>{setDate(d);setModal(null)}}/></GlassModal>
                <GlassModal isOpen={modal==='class'} onClose={()=>setModal(null)} title="Select Class"><div className="p-2">{CLASSES.map(c=><div key={c.code} onClick={()=>{setTrainClass(c);setModal(null)}} className="p-4 mb-2 rounded-lg border font-bold text-slate-700">{c.name}</div>)}</div></GlassModal>
                <GlassModal isOpen={modal==='notify'} onClose={()=>setModal(null)} title="Notifications" center><div className="p-8 text-center text-slate-500">No new notifications</div></GlassModal>

                <div className="fixed bottom-0 w-full max-w-md bg-white/90 backdrop-blur-md border-t py-3 px-6 flex justify-between items-end z-40">
                    <div onClick={()=>setView('home')} className={`flex flex-col items-center gap-1 cursor-pointer ${view==='home'?'text-[#213d77]':'text-slate-400'}`}><i data-lucide="home"></i><span className="text-[10px] font-bold">Home</span></div>
                    <div onClick={()=>setView('trips')} className={`flex flex-col items-center gap-1 cursor-pointer ${view==='trips'?'text-[#213d77]':'text-slate-400'}`}><i data-lucide="ticket"></i><span className="text-[10px]">Trips</span></div>
                    <div className="relative -top-6"><div className="w-14 h-14 bg-[#213d77] rounded-full flex items-center justify-center shadow-lg border-4 border-[#f3f4f6]"><img src="https://upload.wikimedia.org/wikipedia/en/4/45/IRCTC_Logo.svg" className="w-6 h-6 brightness-0 invert" /></div></div>
                    <div onClick={()=>setView('complaint')} className={`flex flex-col items-center gap-1 cursor-pointer ${view==='complaint'?'text-[#213d77]':'text-slate-400'}`}><i data-lucide="message-square-warning"></i><span className="text-[10px]">Support</span></div>
                    <div onClick={()=>setView('settings')} className={`flex flex-col items-center gap-1 cursor-pointer ${view==='settings'?'text-[#213d77]':'text-slate-400'}`}><i data-lucide="settings"></i><span className="text-[10px]">Settings</span></div>
                </div>
            </div>
        );
    }
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Dashboard />);
</script>
</body>
</html>
